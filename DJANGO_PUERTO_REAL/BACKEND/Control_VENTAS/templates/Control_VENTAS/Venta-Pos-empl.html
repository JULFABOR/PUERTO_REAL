<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUERTO REAL - Punto de Venta (POS)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script>
        // Configuración de colores y fuentes para Tailwind CSS
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pr-yellow': '#FFC700',      // Amarillo principal
                        'pr-dark': '#121212',         // Negro suave para tarjetas
                        'pr-dark-gray': '#1F2937',  // Gris oscuro para el fondo
                        'pr-gray': '#6B7280',         // Gris para texto secundario
                    },
                    fontFamily: {
                        'sans': ['Poppins', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilos para el scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1F2937;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4B5563;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }
    </style>
</head>
<body class="bg-pr-dark-gray font-sans text-gray-300">

    <main id="main-content" class="w-screen lg:h-screen lg:overflow-hidden">
         <div class="flex flex-col lg:flex-row lg:h-full">

            <div class="w-full lg:w-3/5 p-6 flex flex-col lg:h-full">
                <div class="flex-shrink-0">
                    <div class="flex justify-between items-center mb-4">
                        <h1 class="text-3xl font-bold text-white">Punto de Venta</h1>
                        <a href="home.html" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa-solid fa-xmark text-2xl"></i>
                        </a>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-4 mb-4">
                        <input type="text" id="search-product" class="flex-grow p-3 text-sm text-white border border-gray-600 rounded-lg bg-pr-dark-gray focus:ring-pr-yellow focus:border-pr-yellow" placeholder="Buscar por nombre o código...">
                    </div>
                    <div id="category-filters" class="flex flex-wrap gap-2 mb-4">
                        <button class="px-4 py-2 text-sm font-semibold rounded-full bg-pr-yellow text-pr-dark" data-category="Todos">Todos</button>
                        <button class="px-4 py-2 text-sm font-semibold rounded-full bg-pr-dark hover:bg-gray-800 text-white" data-category="Vino Tinto">Vinos Tintos</button>
                        <button class="px-4 py-2 text-sm font-semibold rounded-full bg-pr-dark hover:bg-gray-800 text-white" data-category="Vino Blanco">Vinos Blancos</button>
                        <button class="px-4 py-2 text-sm font-semibold rounded-full bg-pr-dark hover:bg-gray-800 text-white" data-category="Espumante">Espumantes</button>
                        <button class="px-4 py-2 text-sm font-semibold rounded-full bg-pr-dark hover:bg-gray-800 text-white" data-category="Destilado">Destilados</button>
                    </div>
                </div>
                <div id="product-grid" class="flex-grow lg:overflow-y-auto custom-scrollbar grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 pr-2">
                    </div>
            </div>

            <div class="w-full lg:w-2/5 bg-pr-dark flex flex-col p-6 lg:h-full">
                <div class="flex-shrink-0 flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-white">Ticket #00123</h2>
                    <button id="select-client-button" class="flex items-center gap-2 text-sm text-pr-yellow hover:underline">
                        <i class="fa-solid fa-user-plus"></i>
                        <span id="client-name-display">Cliente Genérico</span>
                    </button>
                </div>
                <div id="cart-items" class="flex-grow lg:overflow-y-auto custom-scrollbar pr-2">
                     <p id="empty-cart-message" class="text-pr-gray text-center mt-10">El ticket está vacío</p>
                </div>
                <div class="flex-shrink-0 border-t border-gray-700 pt-4 mt-4 space-y-3">
                    <div class="flex justify-between text-lg"><span>Subtotal</span><span id="subtotal-price">$0.00</span></div>
                    <div class="flex justify-between text-lg"><span>Descuento</span><span id="discount-price">$0.00</span></div>
                    <div class="flex justify-between text-2xl font-bold text-pr-yellow"><span>TOTAL</span><span id="total-price">$0.00</span></div>
                </div>
                <div class="flex-shrink-0 mt-6 grid grid-cols-2 gap-4">
                    <button id="cancel-sale-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-4 rounded-lg transition-colors">Cancelar</button>
                    <button id="checkout-button" class="bg-pr-yellow hover:bg-yellow-400 text-pr-dark font-bold py-4 px-4 rounded-lg transition-colors">Cobrar</button>
                </div>
            </div>
        </div>
    </main>

    <div id="checkout-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-4 w-full max-w-md max-h-full">
            <div class="relative rounded-lg shadow bg-pr-dark"><div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t border-gray-600"><h3 class="text-xl font-semibold text-white">Finalizar Venta</h3><button type="button" class="end-2.5 text-gray-400 bg-transparent rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center hover:bg-gray-600 hover:text-white" data-modal-hide="checkout-modal"><svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/></svg><span class="sr-only">Cerrar</span></button></div>
                <div class="p-4 md:p-5">
                    <div class="text-center mb-4"><p class="text-pr-gray">Total a Pagar</p><p class="text-5xl font-bold text-pr-yellow" id="modal-total-price">$0.00</p></div>
                    <form class="space-y-4" id="checkout-form">
                        <div>
                            <label class="block mb-2 text-sm font-medium text-white">Medio de Pago</label>
                            <div id="payment-methods" class="grid grid-cols-3 gap-2">
                                <button type="button" data-method="Efectivo" class="payment-method-button p-2 rounded-lg bg-pr-dark-gray border border-pr-yellow">Efectivo</button>
                                <button type="button" data-method="Tarjeta" class="payment-method-button p-2 rounded-lg bg-pr-dark-gray border border-gray-600">Tarjeta</button>
                                <button type="button" data-method="QR" class="payment-method-button p-2 rounded-lg bg-pr-dark-gray border border-gray-600">QR</button>
                            </div>
                        </div>
                        <div id="cash-payment-section">
                            <label for="amount-paid" class="block mb-2 text-sm font-medium text-white">Monto Recibido</label>
                            <input type="number" name="amount-paid" id="amount-paid" class="border text-lg rounded-lg block w-full p-2.5 bg-pr-dark-gray border-gray-500 placeholder-gray-400 text-white" placeholder="$0.00">
                        </div>
                        <div id="qr-payment-section" class="hidden text-center">
                            <img src="https://placehold.co/200x200/FFFFFF/000000?text=QR+Mercado+Pago" alt="Código QR de Mercado Pago" class="mx-auto rounded-lg">
                            <p class="text-pr-gray mt-2">Escanee el código para pagar</p>
                        </div>
                        <div id="change-due-section" class="flex justify-between items-center text-xl">
                            <span class="font-semibold text-white">Vuelto:</span>
                            <span class="font-bold text-green-500" id="change-due">$0.00</span>
                        </div>
                        <button type="submit" class="w-full text-pr-dark bg-pr-yellow hover:bg-yellow-400 font-bold rounded-lg text-sm px-5 py-2.5 text-center">Confirmar Venta</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

     <div id="client-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-4 w-full max-w-lg max-h-full">
            <div class="relative rounded-lg shadow bg-pr-dark"><div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t border-gray-600"><h3 class="text-xl font-semibold text-white">Seleccionar Cliente</h3><button type="button" class="end-2.5 text-gray-400 bg-transparent rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center hover:bg-gray-600 hover:text-white" data-modal-hide="client-modal"><svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/></svg><span class="sr-only">Cerrar</span></button></div>
                <div class="p-4 md:p-5">
                    <input type="text" class="w-full p-3 mb-4 text-sm text-white border border-gray-600 rounded-lg bg-pr-dark-gray focus:ring-pr-yellow focus:border-pr-yellow" placeholder="Buscar por nombre o DNI...">
                    <ul class="space-y-2 max-h-60 overflow-y-auto custom-scrollbar">
                        <li class="p-3 rounded-lg hover:bg-pr-dark-gray cursor-pointer">Cliente Genérico</li>
                        <li class="p-3 rounded-lg hover:bg-pr-dark-gray cursor-pointer">Juan Pérez</li>
                        <li class="p-3 rounded-lg hover:bg-pr-dark-gray cursor-pointer">Ana García</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DATOS DE EJEMPLO ---
            const products = [
                { id: 1, name: 'Malbec Reserva', price: 8500, image: 'https://placehold.co/200x200/121212/FFC700?text=Vino', category: 'Vino Tinto' },
                { id: 2, name: 'Sauvignon Blanc', price: 6200, image: 'https://placehold.co/200x200/121212/FFC700?text=Vino', category: 'Vino Blanco' },
                { id: 3, name: 'Whisky Single Malt', price: 25000, image: 'https://placehold.co/200x200/121212/FFC700?text=Whisky', category: 'Destilado' },
                { id: 4, name: 'Espumante Extra Brut', price: 9800, image: 'https://placehold.co/200x200/121212/FFC700?text=Espumante', category: 'Espumante' },
                { id: 5, name: 'Gin Artesanal', price: 12500, image: 'https://placehold.co/200x200/121212/FFC700?text=Gin', category: 'Destilado' },
                { id: 6, name: 'Cabernet Sauvignon', price: 8700, image: 'https://placehold.co/200x200/121212/FFC700?text=Vino', category: 'Vino Tinto' },
            ];

            let cart = [];
            let currentTotal = 0;

            // --- ELEMENTOS DEL DOM ---
            const productGrid = document.getElementById('product-grid');
            const cartItemsContainer = document.getElementById('cart-items');
            const subtotalPriceEl = document.getElementById('subtotal-price');
            const totalPriceEl = document.getElementById('total-price');
            const checkoutButton = document.getElementById('checkout-button');
            const cancelSaleButton = document.getElementById('cancel-sale-button');
            const selectClientButton = document.getElementById('select-client-button');
            const categoryFilters = document.getElementById('category-filters');

            // --- MODALES ---
            const checkoutModalEl = document.getElementById('checkout-modal');
            const checkoutModal = new Modal(checkoutModalEl);
            const clientModalEl = document.getElementById('client-modal');
            const clientModal = new Modal(clientModalEl);

            const modalTotalPriceEl = document.getElementById('modal-total-price');
            const amountPaidInput = document.getElementById('amount-paid');
            const changeDueEl = document.getElementById('change-due');
            const checkoutForm = document.getElementById('checkout-form');
            const paymentMethodsContainer = document.getElementById('payment-methods');
            const cashPaymentSection = document.getElementById('cash-payment-section');
            const qrPaymentSection = document.getElementById('qr-payment-section');
            const changeDueSection = document.getElementById('change-due-section');

            // --- FUNCIONES ---
            const formatPrice = (price) => price.toLocaleString('es-AR', { style: 'currency', currency: 'ARS' });

            const renderProducts = (filter = 'Todos') => {
                productGrid.innerHTML = '';
                const filteredProducts = filter === 'Todos' ? products : products.filter(p => p.category === filter);
                
                filteredProducts.forEach(product => {
                    productGrid.innerHTML += `<div class="bg-pr-dark rounded-lg p-3 text-center cursor-pointer hover:ring-2 ring-pr-yellow transition-all duration-200" onclick="addToCart(${product.id})"><img src="${product.image}" class="mx-auto mb-2 rounded aspect-square object-cover"><h4 class="text-sm font-semibold text-white truncate">${product.name}</h4><p class="text-xs text-pr-gray">${formatPrice(product.price)}</p></div>`;
                });
            };

            const renderCart = () => {
                cartItemsContainer.innerHTML = '';
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p id="empty-cart-message" class="text-pr-gray text-center mt-10">El ticket está vacío</p>';
                } else {
                    cart.forEach(item => {
                        cartItemsContainer.innerHTML += `<div class="flex justify-between items-center mb-4"><div><p class="font-semibold text-white">${item.name}</p><p class="text-sm text-pr-gray">${formatPrice(item.price)}</p></div><div class="flex items-center gap-3"><input type="number" value="${item.quantity}" min="1" class="w-16 bg-pr-dark-gray border border-gray-600 rounded text-center" onchange="updateQuantity(${item.id}, this.value)"><button class="text-red-500 hover:text-red-400" onclick="removeFromCart(${item.id})"><i class="fa-solid fa-trash"></i></button></div></div>`;
                    });
                }
                updateTotals();
            };

            const updateTotals = () => {
                currentTotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                subtotalPriceEl.textContent = formatPrice(currentTotal);
                totalPriceEl.textContent = formatPrice(currentTotal);
            };
            
            const resetSale = () => { cart = []; renderCart(); };

            window.addToCart = (productId) => { const product = products.find(p => p.id === productId); const cartItem = cart.find(item => item.id === productId); if (cartItem) cartItem.quantity++; else cart.push({ ...product, quantity: 1 }); renderCart(); };
            window.removeFromCart = (productId) => { cart = cart.filter(item => item.id !== productId); renderCart(); };
            window.updateQuantity = (productId, newQuantity) => { const cartItem = cart.find(item => item.id === productId); if (cartItem) { const quantity = parseInt(newQuantity); if (quantity > 0) cartItem.quantity = quantity; else removeFromCart(productId); } renderCart(); };

            // --- EVENT LISTENERS ---
            cancelSaleButton.addEventListener('click', resetSale);
            selectClientButton.addEventListener('click', () => clientModal.show());
            
            categoryFilters.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    document.querySelector('#category-filters .bg-pr-yellow').classList.replace('bg-pr-yellow','bg-pr-dark');
                    document.querySelector('#category-filters .text-pr-dark').classList.replace('text-pr-dark','text-white');
                    e.target.classList.replace('bg-pr-dark','bg-pr-yellow');
                    e.target.classList.replace('text-white','text-pr-dark');
                    renderProducts(e.target.dataset.category);
                }
            });

            checkoutButton.addEventListener('click', () => {
                if (cart.length === 0) return;
                modalTotalPriceEl.textContent = formatPrice(currentTotal);
                amountPaidInput.value = '';
                changeDueEl.textContent = formatPrice(0);
                // Reset payment method view
                paymentMethodsContainer.querySelector('[data-method="Efectivo"]').click();
                checkoutModal.show();
            });

            paymentMethodsContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    paymentMethodsContainer.querySelectorAll('button').forEach(btn => btn.classList.replace('border-pr-yellow', 'border-gray-600'));
                    e.target.classList.replace('border-gray-600', 'border-pr-yellow');
                    
                    const method = e.target.dataset.method;
                    if (method === 'Efectivo') {
                        cashPaymentSection.classList.remove('hidden');
                        changeDueSection.classList.remove('hidden');
                        qrPaymentSection.classList.add('hidden');
                    } else if (method === 'QR') {
                        cashPaymentSection.classList.add('hidden');
                        changeDueSection.classList.add('hidden');
                        qrPaymentSection.classList.remove('hidden');
                    } else { // Tarjeta
                        cashPaymentSection.classList.add('hidden');
                        changeDueSection.classList.add('hidden');
                        qrPaymentSection.classList.add('hidden');
                    }
                }
            });

            amountPaidInput.addEventListener('input', () => {
                const amountPaid = parseFloat(amountPaidInput.value) || 0;
                const change = amountPaid - currentTotal;
                changeDueEl.textContent = formatPrice(change < 0 ? 0 : change);
            });

            checkoutForm.addEventListener('submit', (e) => {
                e.preventDefault();
                // Aquí iría la lógica para registrar la venta en la base de datos
                console.log('Venta confirmada');
                checkoutModal.hide();
                resetSale();
            });

            // --- INICIALIZACIÓN ---
            renderProducts();
            renderCart();
        });
    </script>
</body>
</html>